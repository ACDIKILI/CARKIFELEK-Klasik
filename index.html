<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Feleğin Çarkı - ARA KUTSAL KOD</title>
    <style>
        body { margin: 0; background-color: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Arial Black', sans-serif; color: white; }
        .phone-frame { width: 360px; height: 640px; background-color: #121212; border: 8px solid #222; border-radius: 40px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        /* Üst Menü ve Seçenekler */
        .top-menu { position: absolute; top: 15px; left: 15px; width: 330px; display: flex; flex-direction: column; gap: 8px; z-index: 300; }
        .row { display: flex; gap: 5px; align-items: center; }
        .mini-board { background-color: #fbc02d; border: 2px solid #000; border-radius: 6px; padding: 4px; min-width: 70px; text-align: center; color: #000; }
        .btn-opt { background: #333; border: 1px solid #fbc02d; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer; }
        .btn-opt.active { background: #fbc02d; color: #000; box-shadow: 0 0 10px #fbc02d; }
        
        /* Çark ve Mekanikler */
        .wheel-container { position: relative; width: 310px; height: 310px; margin-top: 50px; }
        #wheel-canvas { width: 100%; height: 100%; border: 8px solid #ff0000; border-radius: 50%; box-sizing: border-box; }
        .pointer-wrapper { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); z-index: 100; transform-origin: top center; }
        .pointer { width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 45px solid #fbc02d; filter: drop-shadow(0 4px 6px #000); }
        #spin-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 75px; height: 75px; background: #fbc02d; border: 6px solid #ff0000; border-radius: 50%; color: #000; font-weight: 900; font-size: 16px; cursor: pointer; z-index: 200; display: flex; align-items: center; justify-content: center; }

        /* Bilgi Ekranları */
        #status-bar { position: absolute; top: 110px; width: 100%; text-align: center; color: #fbc02d; font-size: 14px; text-shadow: 1px 1px 2px #000; }
        #result-popup { position: absolute; top: 72%; left: 50%; transform: translateX(-50%); padding: 10px 20px; background: radial-gradient(circle, #fff2cc, #ffd700, #b8860b); border: 3px solid #fff; border-radius: 12px; color: #000; font-size: 20px; box-shadow: 0 0 20px #ffd700; z-index: 250; display: none; }
        
        /* Final Tablosu */
        #final-screen { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 500; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .table-row { display: flex; justify-content: space-between; width: 80%; border-bottom: 1px solid #fbc02d; padding: 10px; font-size: 18px; }
        .btn-restart { margin-top: 30px; background: #fbc02d; color: #000; padding: 15px 30px; border: none; border-radius: 10px; font-weight: 900; cursor: pointer; }

        /* İmza */
        .signature { position: absolute; bottom: 15px; font-size: 10px; color: #555; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="phone-frame">
    <div class="top-menu">
        <div class="row">
            <div class="mini-board" style="width: 60px;"><span style="font-size:8px">SKOR</span><div id="cur-val">0</div></div>
            <div class="mini-board" style="width: 70px;"><span style="font-size:8px">TOPLAM</span><div id="tot-val">0</div></div>
            <div class="mini-board" style="flex:1; background: #1a1a1a; color:#fff;"><span style="font-size:8px">MOD</span>
                <div class="row" style="justify-content: center; margin-top:2px;">
                    <div id="opt-single" class="btn-opt active" onclick="setMode('single')">Bireysel</div>
                    <div id="opt-multi" class="btn-opt" onclick="setMode('multi')">Çoklu</div>
                </div>
            </div>
        </div>
        <div id="player-select" class="row" style="display:none; justify-content: flex-end;">
            <span style="font-size:10px; color:#fbc02d;">Oyuncu:</span>
            <div class="btn-opt" onclick="setPlayers(1)">1</div>
            <div class="btn-opt" onclick="setPlayers(2)">2</div>
            <div class="btn-opt" onclick="setPlayers(3)">3</div>
            <div class="btn-opt" onclick="setPlayers(4)">4</div>
            <div class="btn-opt" onclick="setPlayers(5)">5</div>
        </div>
    </div>

    <div id="status-bar">Hoş Geldiniz!</div>

    <div class="wheel-container">
        <div class="pointer-wrapper" id="pointer-ui"><div class="pointer"></div></div>
        <canvas id="wheel-canvas"></canvas>
        <div id="spin-btn">BAS</div>
        <div id="result-popup"></div>
    </div>

    <div id="final-screen">
        <h1 style="color:#fbc02d">OYUN BİTTİ</h1>
        <div id="final-stats" style="width:100%"></div>
        <button class="btn-restart" onclick="resetGame()">YENİ OYUN</button>
    </div>

    <div class="signature">ARA KUTSAL KOD</div>
</div>

<script>
    const canvas = document.getElementById('wheel-canvas');
    const ctx = canvas.getContext('2d');
    const btn = document.getElementById('spin-btn');
    const resultPopup = document.getElementById('result-popup');
    const statusBar = document.getElementById('status-bar');
    const finalScreen = document.getElementById('final-screen');
    const finalStats = document.getElementById('final-stats');

    let gameMode = 'single';
    let playerCount = 1;
    let currentPlayer = 1;
    let currentSpins = 0;
    let playerScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
    let spinning = false;
    let items = ["İFLAS", "PAS", "PAS", "1", "10", "50", "100", "200", "350", "500", "1000", "5000"];

    function setMode(m) {
        if(spinning) return;
        gameMode = m;
        document.getElementById('opt-single').classList.toggle('active', m==='single');
        document.getElementById('opt-multi').classList.toggle('active', m==='multi');
        document.getElementById('player-select').style.display = m==='multi' ? 'flex' : 'none';
        resetGame();
    }

    function setPlayers(n) {
        if(spinning) return;
        playerCount = n;
        document.querySelectorAll('#player-select .btn-opt').forEach((b, i) => {
            b.classList.toggle('active', (i+1) === n);
        });
        resetGame();
    }

    function resetGame() {
        currentPlayer = 1; currentSpins = 0;
        playerScores = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
        document.getElementById('tot-val').innerText = '0';
        document.getElementById('cur-val').innerText = '0';
        finalScreen.style.display = 'none';
        updateStatus();
        draw();
    }

    function updateStatus() {
        if(gameMode === 'single') statusBar.innerText = "Bireysel Mod: Sınırsız Hak";
        else statusBar.innerText = `Oyuncu ${currentPlayer} | Hak: ${10 - currentSpins}/10`;
    }

    // --- Ses ve Çizim Fonksiyonları (Önceki versiyonla aynı mantık) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTick() { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.frequency.setValueAtTime(1200, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.04); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.04); }
    function playWhirr(p) { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'sawtooth'; osc.frequency.setValueAtTime(80 + (p * 200), audioCtx.currentTime); gain.gain.setValueAtTime(0.01, audioCtx.currentTime); gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.08); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.08); }

    function draw() {
        const r = 250; canvas.width = 500; canvas.height = 500;
        const arc = (Math.PI * 2) / items.length;
        items.forEach((text, i) => {
            const angle = i * arc;
            ctx.beginPath();
            if (text === "İFLAS") ctx.fillStyle = "#000";
            else if (text === "PAS") ctx.fillStyle = "#808080";
            else if (parseInt(text) < 100) ctx.fillStyle = "#fbc02d";
            else if (parseInt(text) < 1000) ctx.fillStyle = "#2E7D32";
            else if (text === "1000") ctx.fillStyle = "#1565C0";
            else ctx.fillStyle = "#C62828";
            
            ctx.moveTo(r, r); ctx.arc(r, r, r, angle, angle + arc); ctx.fill();
            ctx.strokeStyle = "#000"; ctx.lineWidth = 4; ctx.stroke();
            
            ctx.save(); ctx.translate(r, r); ctx.rotate(angle);
            ctx.beginPath(); ctx.arc(r - 15, 0, 6, 0, Math.PI * 2); ctx.fillStyle = "#000"; ctx.fill();
            ctx.restore();

            ctx.save(); ctx.translate(r, r); ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right"; ctx.fillStyle = (text==="İFLAS"||text==="PAS"||parseInt(text)>=100) ? "#fff":"#000";
            ctx.font = "bold 30px Arial"; ctx.fillText(text, r - 45, 10); ctx.restore();
        });
    }

    let currentRotation = 0;
    btn.addEventListener('click', () => {
        if (spinning) return;
        spinning = true;
        resultPopup.style.display = "none";
        if (audioCtx.state === 'suspended') audioCtx.resume();
        items.sort(() => Math.random() - 0.5);
        draw();

        const duration = 7000 + Math.random() * 3000;
        const extraSpins = (10 + Math.random() * 5) * 360;
        const startTime = performance.now();
        let lastTickAngle = 0;

        function animate(time) {
            const elapsed = time - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const easing = 1 - Math.pow(1 - progress, 3);
            const currentAngle = currentRotation + (extraSpins * easing);
            canvas.style.transform = `rotate(${currentAngle % 360}deg)`;

            if (progress < 0.5) { if (Math.floor(elapsed / 80) !== Math.floor((elapsed - 16) / 80)) playWhirr(progress); }
            else {
                if (Math.abs(currentAngle - lastTickAngle) >= (360/items.length)) {
                    playTick(); lastTickAngle = currentAngle;
                    document.getElementById('pointer-ui').style.transform = "translateX(-50%) rotate(-15deg)";
                    setTimeout(() => document.getElementById('pointer-ui').style.transform = "translateX(-50%) rotate(0deg)", 50);
                }
            }

            if (progress < 1) requestAnimationFrame(animate);
            else {
                spinning = false;
                currentRotation = currentAngle;
                const idx = Math.floor((360 - (currentAngle % 360) + 270) % 360 / (360 / items.length));
                const res = items[idx % items.length];
                
                handleResult(res);
            }
        }
        requestAnimationFrame(animate);
    });

    function handleResult(res) {
        if (res === "İFLAS") playerScores[currentPlayer] = 0;
        else if (res !== "PAS") playerScores[currentPlayer] += parseInt(res);

        document.getElementById('cur-val').innerText = res;
        document.getElementById('tot-val').innerText = playerScores[currentPlayer];
        resultPopup.innerText = res;
        resultPopup.style.display = "block";

        if (gameMode === 'multi') {
            currentSpins++;
            if (currentSpins >= 10) {
                if (currentPlayer < playerCount) {
                    setTimeout(() => {
                        alert(`Oyuncu ${currentPlayer} bitti! Sıra Oyuncu ${++currentPlayer}'de.`);
                        currentSpins = 0;
                        document.getElementById('tot-val').innerText = '0';
                        updateStatus();
                    }, 1500);
                } else {
                    showFinalTable();
                }
            }
        }
        updateStatus();
    }

    function showFinalTable() {
        finalStats.innerHTML = "";
        for (let i = 1; i <= playerCount; i++) {
            finalStats.innerHTML += `<div class="table-row"><span>Oyuncu ${i}</span><span>${playerScores[i]} Puan</span></div>`;
        }
        finalScreen.style.display = "flex";
    }

    draw();
    updateStatus();
</script>
</body>
</html>